---
title: 'Severe Weather Events in the US: Health and Economic Issues'
author: "Francisco Marco-Serrano"
output: html_document
---

#Synopsis

Immediately after the title, there should be a synopsis which describes and summarizes your analysis in at most 10 complete sentences.

#Data Processing

From the [U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database](www.ncdc.noaa.gov/stormevents) we obtained data on major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage since 1950 until November 2011.

We first read the data from the bz2 compressed file. The data is a CSV file containing 902297 rows and 37 variables.

```{r cache = TRUE}
storm.df = read.csv("repdata-data-StormData.csv.bz2")

dim(storm.df)  # how big the data frame is
str(storm.df)  # which is the structure
head(storm.df) # show first few rows
 
```

We make sure the date is formated adequately, and create a new variable (YEAR). Keep only the variables for YEAR, STATE, Event Type, Population Health (FATALITIESand INJuRIES), and Economic Consequences (PROPDMG for property damages and CROPDMG for crop damages).

```{r}
storm.df$BGN_DATE = as.Date(storm.df$BGN_DATE, format = "%m/%d/%Y %H:%M:%S")
storm.df$YEAR = as.factor(format(storm.df$BGN_DATE, "%Y")) 
 
# subset, to keep only the variables we are interested in
keeps = c("YEAR", "STATE", "EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "CROPDMG")
storm.df = storm.df[ , keeps]
 
```

We group the data adding the four variables of interest per year, State, and type of event.

```{r}
# totals per year-state-event
storm.states = aggregate(cbind(FATALITIES, INJURIES, PROPDMG, CROPDMG) ~ YEAR + STATE + EVTYPE, data = storm.df, FUN="sum")

# totals per year-event
storm.events = aggregate(cbind(FATALITIES, INJURIES, PROPDMG, CROPDMG) ~ YEAR + EVTYPE, data = storm.df, FUN="sum")

# totals per event
storm.total = aggregate(cbind(FATALITIES, INJURIES, PROPDMG, CROPDMG) ~ EVTYPE, data = storm.df, FUN="sum")

```

#Results

Show Top 10 events with higher values for each one of the four variables.

```{r}

head(storm.total[order(-storm.total$FATALITIES),]], 10)
head(storm.total[order(-storm.total$INJURIES),], 10)
head(storm.total[order(-storm.total$PROPDMG),], 10)
head(storm.total[order(-storm.total$CROPDMG),], 10)

```

We generate the 'Population Health' variable adding FATALITIES and INJURIES, and the 'Economic Consequences' variable adding PROPDMG and CROPDMG.

```{r}

storm.total$POPHEALTH = storm.total$FATALITIES + storm.total$INJURIES
storm.total$ECONCONS = storm.total$PROPDMG + storm.total$CROPDMG

```

Show Top 10 events most harmful for population health.

```{r}

storm.total.top10H = storm.total[order(-storm.total$POPHEALTH),]], 10)

counts = table(storm.total.top10H$FATALITIES, storm.total.top10H$INJURIES)
barplot(counts, main="Top 10 Most Harmful Events for Population Health",
        horiz = TRUE, col=c("darkblue","red"), legend = rownames(counts))

storm.total.top10E = storm.total[order(-storm.total$ECONCONS),]], 10)

counts = table(storm.total.top10E$PROPDMG, storm.total.top10E$CROPDMG)
barplot(counts, main="Top 10 Events with Greatest Economic Consequences",
        horiz = TRUE, col=c("darkblue","red"), legend = rownames(counts))

```

This analysis can be replicated at State level.
